# Yolo v5
## Source 
* Yolo v5 orginal      : https://github.com/ultralytics/yolov5 
* Yolo v5 forked      : https://github.com/nowage/yolov5
* This Implementation : https://datacook.tistory.com/60





# Setting

## Set Variable


```python

# Data file 
url = 'https://public.roboflow.com/ds/eL4QUdkpSR?key=0ikL5WLM1w'
# Data file Path
dPath='/content/drive/MyDrive/imgAugWithSR_prj/data/yolov5_mask'  

# Working folder Path
wPath='/content/drive/MyDrive/imgAugWithSR_prj/ImgAugWithSR/yolov5'

```


```python
# %cd /content/drive/MyDrive/imgAugWithSR_prj/ImgAugWithSR
# !git clone https://github.com/nowage/yolov5.git
```

## Library Install


```python
!pip uninstall -y imgaug
```


```python
%cd {wPath}
!pip install -r requirements.txt

```

## Library Loading


```python
from os.path import join,isfile,isdir
import pandas as pd
import numpy as np

```

## Google Drive Mount


```python
from google.colab import drive
isMount=!df |grep /content/drive
if len(isMount) < 1 : drive.mount('/content/drive', force_remount=False)

```

# Data Load

## Training File Load


```python
# %cd /
# !rm -rf {dPath}
# %mkdir /content/drive/MyDrive/imgAugWithSR_prj/ImgAugWithSR/YOLO_v5/yolov5_mask

if not isdir(dPath) :
  !mkdir {dPath}
  %cd {dPath}
  !pwd
  !curl -L "{url}" > roboflow.zip; unzip roboflow.zip; rm roboflow.zip    
else:
  print('기존 Data file 사용')
  %cd {dPath}
  !ls {dPath}
  
```


```python
%cd {wPath}
```


```python
import yaml

with open(join(dPath,'data.yaml'), 'r') as f:
  data = yaml.load(f, Loader=yaml.FullLoader)


data['train'] = dPath
data['test'] = dPath
data['val'] = dPath

with open(join(dPath,'data.yaml'), 'w') as f:
  yaml.dump(data, f)


```

# Train


```python
%cd {wPath}

!python train.py --help
```


```python
!ls {wPath}/runs/train
```


```python
%cd {wPath}

!python train.py --img 416 --batch 16 --epochs 50 --data {dPath}/data.yaml --cfg ./models/yolov5s.yaml --weights yolov5s.pt --name mask_yolov5s_results
```

## TensorBoard


```python
%load_ext tensorboard
%tensorboard --logdir {wPath}/runs/

```

# Implementation


```python
%cd {wPath}

from glob import glob

img_list = glob(join(dPath,'test/images/*.jpg'))

print(len(img_list))
```

## Test


```python
!ls {join(wPath,'runs/train')}
```


```python
from IPython.display import Image
import os

val_img_path = img_list[0]

weights_path = join(wPath,'runs/train/mask_yolov5s_results/weights/best.pt')
!python detect.py --weights "{weights_path}" --img 416 --conf 0.5 --source "{val_img_path}"


```

## Result Show


```python
!ls {join(wPath,'runs/detect/')}
```


```python
detect_img_path = join(wPath,'runs/detect/exp5')
Image(join(detect_img_path, os.path.basename(val_img_path)))
```


```python

```
